---
title: "CancerEcon Tutorial"
subtitle:  "Reading, Basic Indexing, and Merging Data"
author: Nick Fong (nick.fong [at])
date: 2020-06-25
output: html_document
---

## Library Imports ## dplyr is loaded as a dependancy of tidyverse, not sure what 'here' is so i'll leave it by itself with supress
These need to be run to import other libraries, or collections of functions writen by other people to make our jobs easier
```{r}
suppressMessages(library(here))
packages <- c("readxl","openxlsx","tidyverse","lubridate","data.table")
new.packages <- packages[!(packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
```
## setwd
We need to make sure that R is looking in the right folder for both reading and writing of data and figures. We will use the command setwd() to acomplish. If at any time you want to see where R is looking, you can run the command getwd() inside the brackets of setwd(), put in quotes the folder you want to make R look at. For example, on a mac, running the command setwd("~/Desktop") would have R look at your desktop folder. The ~/ is a shortcut for the directory path to the user folder
```{r}
setwd=("your directory here!")
getwd()
```

## Read an Excel file and CSV file into separte dataframes `merged` and `country_codes`, respectively. On the command we use to read the excel file, the text "readxl" before the :: denotes the library that the command comes from, while the "read_xlsx" that comes after is the function we are calling ## we don't need merged codes, allmerged already has the preprocessing it was used for done
```{r}
merged <- readxl::read_xlsx(here::here("allmerged.xlsx"), sheet = 1, guess_max = 5000)
```
## Indexing and Assigning Variables:  Rename columns
Let's see what the names of the columns in our `country_codes` dataframe look like: 
```{r}
colnames(country_codes)
```
We can rename the columns by indexing into the list of columns.  Each element in the list of columns has an index, starting with 1:
```{r}
colnames(country_codes)[1]
colnames(country_codes)[2]
```
What would you expect `colnames(country_codes)[3]` to output?
```{r}
colnames(country_codes)[3]
```
So we can rename the columns by assigning new names to the indexed elements:
```{r}
colnames(country_codes)[2] <- 'Name'
colnames(country_codes)[3] <- 'ISO3166'
```
We can also drop columns we don't care about in anticipation of our merge later.  The `%>%` is called a pipe; don't worry about what this is doing for now.  Note that the `select` function from `dplyr` chooses which columns you want to keep:
```{r}
country_codes <- country_codes %>% select(Name, ISO3166)
```
And now we can check our work: ## maybe a good spot to introduce head() 
```{r}
colnames(country_codes)
```

## Merge Data:  Add country names to merged data
Now we're going to add the country codes to our merged data so that it's easier for us to read.  To do this, we need a column in the `merged` dataframe that has the same name as the `country_code` data frame, so we'll start by renaming the relevant column in `merged`:
```{r}
colnames(merged)[2] <- 'ISO3166'
```
Next we should check to make sure that the column names are correct.  Verify that this is the case in the block below:
```{r}
# Your code here
```

Now we can merge the two data frames.  We're going to do a left outer join using the `merge` function.  This means that we want every row in the `merged` data frame to be preserved, and to ignore rows in the `country_codes` data frame that don't have a corresponding row in `merged`.  `Left` refers to the fact that we're preserving the rows in the left data frame, where left is given by the first argument to `merge` and right is given by the second argument.  If this doesn't make sense, don't worry about it for now.
```{r}
merged <- merge(merged, country_codes, by='ISO3166', all.x=TRUE)
```

It might be helpful to have the country names in the first column.  `dplyr` makes this easy for us:
```{r}
merged <- merged %>% select(Name, everything())
```

And now we can look at our data frame and see that we've added the country names to each row in our dataframe:
```{r}
merged
```
Finally, we can write our changes back to disk: ## do setwd() somewhere before this, default dir depends on installation I think but it's user/documents for me on win10 r3.6.3
```{r}
write.csv(merged, file = here::here("merged_with_country_names.csv"), row.names = FALSE)
```
